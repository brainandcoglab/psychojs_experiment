# Base PsychoJS/PsychoPy online framework

This repository is based on
https://github.com/brainandcoglab/UDN_classification_task/commit/5da8bcd017

# Repository structure guide

```bash
├── lib/ # (misc javascript libraries to import go here)
│   ├── pixi* # (pixiJS library files)
│   └── psychojs* # (psychoJS library files)
│
├── res/ # (non-code resources like images or csv files go here)
│   ├── *.csv # (csv files can be used to set trial data in PsychoPy)
│   └── *.png # (image files can be used as stimuli, for example)
│
├── src/ # (the main source code for your experiment goes here)
│   └── *.js # (you can import these files in code components in PsychoPy)
│
├── README.md # (you are here)
├── _config.yml # (ignore this, makes hosting on Github Pages work)
├── index.html # (web page autogenerated by PsychoPy)
├── psychojs_experiment-legacy-browsers.js # (code autogenerated by PychoPy)
├── psychojs_experiment.js # (code autogenerated by PychoPy)
└── psychojs_experiment.psyexp # (PsychoPy experiment file)
```

# Coding your project

Generally, you can proceed as though this were a normal PsychoPy project. In an
ideal world, a PsychoPy experiment would run in exactly the same manner online.
With the way this is implemented however that's unlikely to happen. If you want
to target online, you should exclusively write and test with that in mind. In
PsychoPy, you can write JS code in "components", [see
docs](https://psychopy.org/builder/components/code.html). When you make a
component, make sure code type is set to "JS". Components help to organize when
your code will run (e.g. you can run a certain piece of code at the start or end
of a trial). When you build for online (ctrl + e), a complete js file is created
(psychojs_experiment.js) which contains all the code in your components, ordered
correctly. You don't strictly need to install PsychoPy (the tool itself) to code
in PsychoJS, you could write a psychojs_experiment.js directly. However, it may
be difficult to figure out how to do things. You could generate this file and
then edit it directly, but you cannot then re-open your changes in the PsychoPy
Builder GUI.

# About this example

A moving DVD logo will appear on the screen, you will press 'A' if it is red, or
'L' if it is blue. A csv file containing responses and reaction times is
retained. Most code occurs in the trial_code component, but setup parameters are
found in para.js. Generally if lots of complex setup is needed, I recommend
putting that in a separate file like para.js that you can then import. This has
the advantage of not needing to touch PsychoPy at all to reload the experiment
when you make changes (just refresh the web page).

## Notes on JS imports

At the beginning of the experiment, I import external js using:

`import * as para from "./src/para.js"`

This has the effect of making any variable "thing" exported from para.js
available as "para.thing" inside PsychoPy.

# Testing your project

- Start a web server in the project root directory (here). 
  - You can use the "Run PsychoJS task in local debug mode" button found on the PsychoPy Runner window.
  - Alternatively, run your own web server, e.g., `python -m http.server`. Any will do.
  - If hosted on Github you can also use Github pages to serve it (although this requires committing changes to test them).
- Always force a hard page refresh to prevent the browser caching stuff (usual shortcut is ctrl+shift+r)

## Performance notes

PsychoJS generally seems a little more stable on chrome.
[Should be okay though](https://www.researchgate.net/publication/343081686_The_timing_mega-study_comparing_a_range_of_experiment_generators_both_lab-based_and_online).

# Uploading your project

- Easiest way to host is with Pavlovia.

## Really useful PsychoJS cheat sheet for Python -> JS conversions

Python idioms and PsychoPy functions don't always translate well to JS. This
link is quite helpful for finding equivalents.
https://docs.google.com/document/d/13jp0QAqQeFlYSjeZS0fDInvgaDzBXjGQNe4VNKbbNHQ/
